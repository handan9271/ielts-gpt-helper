<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>雅思树洞 · GPT Writing Coach</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="data:,">
  <script src="https://cdn.staticfile.org/marked/9.0.3/marked.min.js"></script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background-color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      justify-content: center;
      color: #111;
    }

    .container {
      width: 100%;
      max-width: 640px;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
    }

    h1 {
      font-size: 1.75rem;
      font-weight: 600;
      text-align: center;
      color: #000;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      text-align: center;
      color: #666;
      font-size: 0.95rem;
      margin-bottom: 1rem;
    }

    input, textarea {
      width: 100%;
      padding: 1rem;
      font-size: 1rem;
      border: 1px solid #ddd;
      border-radius: 12px;
      background: #fafafa;
      transition: border-color 0.2s;
    }

    input:focus, textarea:focus {
      outline: none;
      border-color: #10a37f;
      background: #fff;
    }

    textarea {
      resize: vertical;
      min-height: 140px;
    }

    button {
      padding: 1rem;
      border: none;
      border-radius: 12px;
      font-size: 1rem;
      background-color: #10a37f;
      color: white;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #0e8c6d;
    }

    .output-box {
      white-space: normal;
      padding: 1.5rem;
      border-radius: 12px;
      background-color: #f3f3f3;
      color: #222;
      line-height: 1.7;
    }

    .loading {
      text-align: center;
      color: #999;
      font-style: italic;
    }

    mark {
      background: #fff2a8;
      padding: 0 4px;
      border-radius: 4px;
    }

    footer {
      margin-top: 2rem;
      font-size: 0.85rem;
      color: #aaa;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>雅思树洞 · GPT Writing Coach</h1>
    <p class="subtitle">写下你的想法，我来帮你润色成地道英文 ✨</p>

    <input id="question" placeholder="请输入英文或中文题目，例如：Describe a person you admire" />

    <textarea id="input" placeholder="用中文写下你想表达的内容吧～"></textarea>

    <button onclick="submit()">💬 优化成英文表达</button>

    <div id="output" class="output-box" style="display:none;"></div>
  </div>

  <footer>© 2025 GOAT IELTS. All rights reserved.</footer>

  <script>
    const encouragements = [
      "🌟 每一次表达，都是一次突破 💪",
      "💬 继续表达，你已经比昨天更棒了！",
      "🎧 小助教已准备好，随时帮你润色英文！",
      "📖 英文表达越练越有感觉～"
    ];

    marked.use({
      extensions: [{
        name: "highlight",
        level: "inline",
        start(src) { return src.match(/==/)?.index },
        tokenizer(src) {
          const match = /^==(.+?)==/.exec(src);
          if (match) return { type: "highlight", raw: match[0], text: match[1], tokens: [] };
        },
        renderer(token) {
          return `<mark>${token.text}</mark>`;
        }
      }]
    });

    async function submit() {
      const question = document.getElementById('question').value.trim();
      const input = document.getElementById('input').value.trim();
      const outputBox = document.getElementById('output');

      if (!input || !question) {
        outputBox.style.display = 'block';
        outputBox.innerHTML = "⚠️ 请填写题目和中文思路。";
        return;
      }

      outputBox.style.display = 'block';
      outputBox.className = "output-box loading";
      outputBox.innerHTML = "⏳ 小助教正在认真优化中，请稍候…";

      try {
        const res = await fetch("https://ielts-gpt-helper.onrender.com/api/ielts-helper", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question, input })
        });
        const data = await res.json();
        const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
        outputBox.className = "output-box";
        outputBox.innerHTML = marked.parse(data.reply + "\n\n" + encouragement);
      } catch (e) {
        outputBox.className = "output-box";
        outputBox.innerHTML = "❌ 请求失败，请检查服务是否正常。";
      }
    }
  </script>
</body>
</html>
