<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>雅思树洞 · 倾听你的表达，优化你的英文</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: "Arial", sans-serif; max-width: 800px; margin: auto; padding: 2rem; line-height: 1.6; }
    textarea, button { width: 100%; font-size: 1rem; margin-top: 1rem; }
    textarea { height: 120px; padding: 0.5rem; }
    #output { white-space: pre-wrap; background: #f6f6f6; padding: 1rem; border-radius: 6px; margin-top: 1.5rem; }
    .loading { color: gray; font-style: italic; font-size: 1rem; display: flex; align-items: center; gap: 0.5rem; }
    .zh { color: #666; font-size: 0.95rem; }
    .btn-row { display: flex; gap: 1rem; margin-top: 0.5rem; }
    .btn-row button { flex: 1; }
    .subtitle { color: #888; font-size: 0.95rem; margin-top: -1rem; margin-bottom: 1rem; }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(180deg); }
      100% { transform: rotate(360deg); }
    }
    #hourglass {
      display: inline-block;
      animation: spin 2s linear infinite;
      font-size: 1.4rem;
    }
  </style>
</head>
<body>
  <h2>欢迎来到「雅思树洞」</h2>
  <p class="subtitle">我会认真听你说出想法，帮你优化成英文表达，还会给出一点温柔的评分建议 💛</p>

  <label>🧠 今天我们聊聊这个话题：</label>
  <div id="current-question" style="margin-top: 0.5rem; font-weight: bold;"></div>
  <p style="font-size: 0.9rem; color: #999;">💡 不喜欢这个题目？点按钮换一个～</p>
  <div class="btn-row">
    <button onclick="loadQuestion()">🎲 换一个题目</button>
  </div>

  <label for="input">✏️ 想说点什么呢？</label>
  <textarea id="input" placeholder="把你想说的写下来，随便写，我会帮你变成更清晰的英文表达…"></textarea>

  <button onclick="submit()">💬 优化成英文表达</button>

  <div id="output"></div>

  <p style="text-align:center; color:#aaa; margin-top:2rem;">
    🌱 每一次表达，都是你在「雅思树洞」里种下的成长种子。
  </p>

  <script>
    let selectedQuestion = { en: '', zh: '' };

    const encouragements = [
      "🌟 想说得更好？下一题见！你的每一次表达，都是进步的开始 💪",
      "💬 继续试试看下一题？我还想听你说～",
      "📖 每一次练习，都是在积累属于你的语言力量。",
      "🎧 小助教还在这儿，随时帮你继续表达～",
      "✨ 坚持表达的你，真的越来越棒了！"
    ];

    async function loadQuestion() {
      const qDiv = document.getElementById("current-question");
      qDiv.innerHTML = "⏳ 正在为你挑选新题目...";
      try {
        const res = await fetch("https://ielts-gpt-helper.onrender.com/api/random-question");
        const data = await res.json();
        selectedQuestion = data;
        qDiv.innerHTML = `${data.en}<br/><span class='zh'>📖 中文：${data.zh}</span>`;
      } catch (e) {
        qDiv.innerHTML = "❌ 获取题目失败，请稍后再试。";
      }
    }

    window.onload = () => loadQuestion();

    async function submit() {
      const input = document.getElementById('input').value.trim();
      const output = document.getElementById('output');
      if (!input) {
        output.innerText = "⚠️ 请输入你的中文思路。";
        return;
      }

      output.innerHTML = `
        <div class="loading">
          <span id="hourglass">⏳</span>
          小助教正在认真思考中，请稍候…
        </div>
      `;

      try {
        const res = await fetch("https://ielts-gpt-helper.onrender.com/api/ielts-helper", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question: selectedQuestion.en, input })
        });
        const data = await res.json();
        const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
        output.innerText = (data.reply || "⚠️ 生成失败，请重试或检查服务状态。") + "\n\n" + encouragement;
      } catch (e) {
        output.innerText = "❌ 请求失败，请检查服务是否在线。";
      }
    }
  </script>
</body>
</html>
