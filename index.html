<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>é›…æ€æ ‘æ´ Â· å€¾å¬ä½ çš„è¡¨è¾¾ï¼Œä¼˜åŒ–ä½ çš„è‹±æ–‡</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="data:,">
  <script src="https://cdn.staticfile.org/marked/9.0.3/marked.min.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
      background-color: #fff;
      color: #111;
      margin: 0;
      padding: 2rem;
      max-width: 720px;
      margin-left: auto;
      margin-right: auto;
      line-height: 1.8;
    }
    h2 { font-size: 1.6rem; margin-bottom: 0.5rem; }
    textarea, input, button {
      width: 100%;
      font-size: 1rem;
      margin-top: 1rem;
      padding: 0.75rem;
      border-radius: 8px;
      border: 1px solid #ddd;
      box-sizing: border-box;
    }
    textarea { height: 120px; }
    button {
      background-color: #111;
      color: #fff;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    button:hover { background-color: #333; }
    #output {
      white-space: normal;
      margin-top: 1.5rem;
      padding: 1rem;
      border-radius: 8px;
      background-color: #f9f9f9;
      color: #222;
    }
    .loading-state {
      text-align: center;
      color: #666;
      font-style: italic;
    }
    .btn-row {
      display: flex;
      gap: 1rem;
      margin-top: 0.5rem;
    }
    .btn-row button {
      flex: 1;
    }
    mark {
      background: #fff2a8;
      padding: 0 4px;
      border-radius: 4px;
    }
    .subtitle {
      font-size: 0.95rem;
      color: #888;
      margin-top: -0.5rem;
      margin-bottom: 1.5rem;
    }
    .zh {
      color: #666;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <h2>æ¬¢è¿æ¥åˆ°ã€Œé›…æ€æ ‘æ´ã€</h2>
  <p class="subtitle">æˆ‘ä¼šè®¤çœŸå¬ä½ è¯´å‡ºæƒ³æ³•ï¼Œå¸®ä½ ä¼˜åŒ–æˆè‹±æ–‡è¡¨è¾¾ï¼Œè¿˜ä¼šç»™å‡ºä¸€ç‚¹æ¸©æŸ”çš„è¯„åˆ†å»ºè®® ğŸ’›</p>

  <div id="current-question"></div>
  <div class="btn-row">
    <button onclick="loadQuestion()">ğŸ² æˆ‘å¼ºçš„å¯æ€•ï¼Œéšæœºæ¥ä¸€ä¸ªé¢˜ç›®</button>
  </div>

  <label for="question">ğŸ¯å…¶å®æˆ‘è‡ªå¸¦äº†é¢˜ç›®</label>
  <input id="question" type="text" placeholder="Describe a person you admire">

  <label for="input">âœï¸ å†™ä¸‹ä½ çš„ç»å†å’Œæƒ³æ³•</label>
  <textarea id="input" placeholder="éšä¾¿å†™å†™ä½ çš„ç»å†ã€æƒ³æ³•æˆ–å°æ•…äº‹ï¼Œç”¨ä¸­æ–‡æˆ–è‹±æ–‡éƒ½å¯ä»¥ï¼Œæˆ‘æ¥å¸®ä½ å˜æˆåœ°é“å¹¶ä¸”é€‚åˆé›…æ€è€ƒè¯•çš„è‹±æ–‡ï½"></textarea>

  <button onclick="submit()">ğŸ’¬ ä¼˜åŒ–æˆè‹±æ–‡è¡¨è¾¾</button>

  <div id="output"></div>

  <p style="text-align:center; color:#aaa; margin-top:2rem;">
    ğŸŒ± æ¯ä¸€æ¬¡è¡¨è¾¾ï¼Œéƒ½æ˜¯ä½ åœ¨ã€Œé›…æ€æ ‘æ´ã€é‡Œç§ä¸‹çš„æˆé•¿ç§å­ã€‚
  </p>

  <script>
    let selectedQuestion = { en: '', zh: '' };

    const encouragements = [
      "ğŸŒŸ æƒ³è¯´å¾—æ›´å¥½ï¼Ÿä¸‹ä¸€é¢˜è§ï¼ä½ çš„æ¯ä¸€æ¬¡è¡¨è¾¾ï¼Œéƒ½æ˜¯è¿›æ­¥çš„å¼€å§‹ ğŸ’ª",
      "ğŸ’¬ ç»§ç»­è¯•è¯•çœ‹ä¸‹ä¸€é¢˜ï¼Ÿæˆ‘è¿˜æƒ³å¬ä½ è¯´ï½",
      "ğŸ“– æ¯ä¸€æ¬¡ç»ƒä¹ ï¼Œéƒ½æ˜¯åœ¨ç§¯ç´¯å±äºä½ çš„è¯­è¨€åŠ›é‡ã€‚",
      "ğŸ§ å°åŠ©æ•™è¿˜åœ¨è¿™å„¿ï¼Œéšæ—¶å¸®ä½ ç»§ç»­è¡¨è¾¾ï½",
      "âœ¨ åšæŒè¡¨è¾¾çš„ä½ ï¼ŒçœŸçš„è¶Šæ¥è¶Šæ£’äº†ï¼"
    ];

    marked.use({
      extensions: [
        {
          name: "highlight",
          level: "inline",
          start(src) { return src.match(/==/)?.index },
          tokenizer(src) {
            const match = /^==(.+?)==/.exec(src);
            if (match) {
              return { type: "highlight", raw: match[0], text: match[1], tokens: [] };
            }
          },
          renderer(token) {
            return `<mark>${token.text}</mark>`;
          }
        }
      ]
    });

    async function loadQuestion() {
      const qDiv = document.getElementById("current-question");
      const questionInput = document.getElementById("question");
      qDiv.innerHTML = "â³ æ­£åœ¨ä¸ºä½ æŒ‘é€‰æ–°é¢˜ç›®...";
      try {
        const res = await fetch("https://ielts-gpt-helper.onrender.com/api/random-question");
        const data = await res.json();
        selectedQuestion = data;
        qDiv.innerHTML = `<strong>${data.en}</strong><br/><span class='zh'>ğŸ“– ä¸­æ–‡ï¼š${data.zh}</span>`;
        questionInput.value = data.en;
      } catch (e) {
        qDiv.innerHTML = "âŒ è·å–é¢˜ç›®å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚";
      }
    }

    window.onload = () => loadQuestion();

    async function submit() {
      const input = document.getElementById('input').value.trim();
      const question = document.getElementById('question').value.trim();
      const output = document.getElementById('output');

      if (!input) {
        output.innerText = "âš ï¸ è¯·è¾“å…¥ä½ çš„ä¸­æ–‡æ€è·¯ã€‚";
        return;
      }

      if (!question) {
        output.innerText = "âš ï¸ è¯·è¾“å…¥æˆ–é€‰æ‹©ä¸€ä¸ªè‹±æ–‡é¢˜ç›®ã€‚";
        return;
      }

      output.className = "loading-state";
      output.innerHTML = `<span id="hourglass">â³</span> å°åŠ©æ•™æ­£åœ¨è®¤çœŸæ€è€ƒä¸­ï¼Œè¯·ç¨å€™â€¦`;

      try {
        const res = await fetch("https://ielts-gpt-helper.onrender.com/api/ielts-helper", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question, input })
        });
        const data = await res.json();
        const encouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
        output.className = "";
        output.innerHTML = marked.parse((data.reply || "âš ï¸ ç”Ÿæˆå¤±è´¥ï¼Œè¯·é‡è¯•æˆ–æ£€æŸ¥æœåŠ¡çŠ¶æ€ã€‚") + "\n\n" + encouragement);
      } catch (e) {
        output.className = "";
        output.innerText = "âŒ è¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡æ˜¯å¦åœ¨çº¿ã€‚";
      }
    }
  </script>
</body>
</html>
